<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-base-camp docs-doc-id-docs/storage/how-storage-works">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">How Storage Works | Base</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.base.org/base-camp/docs/storage/how-storage-works"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-base-camp-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-base-camp-current"><meta data-rh="true" property="og:title" content="How Storage Works | Base"><meta data-rh="true" name="description" content="An introduction to how storage works in Ethereum"><meta data-rh="true" property="og:description" content="An introduction to how storage works in Ethereum"><link data-rh="true" rel="icon" href="../../../../img/favicon.ico"><link data-rh="true" rel="canonical" href="index.html"><link data-rh="true" rel="alternate" href="index.html" hreflang="en"><link data-rh="true" rel="alternate" href="index.html" hreflang="x-default"><link rel="stylesheet" href="../../../../assets/css/styles.3692d699.css">
<link rel="preload" href="../../../../assets/js/runtime~main.3b600ada.js" as="script">
<link rel="preload" href="../../../../assets/js/main.5ec255ba.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div data-rk=""><style>[data-rk]{--rk-blurs-modalOverlay:blur(0px);--rk-fonts-body:SFRounded, ui-rounded, "SF Pro Rounded", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";--rk-radii-actionButton:9999px;--rk-radii-connectButton:12px;--rk-radii-menuButton:12px;--rk-radii-modal:24px;--rk-radii-modalMobile:28px;--rk-colors-accentColor:#0E76FD;--rk-colors-accentColorForeground:#FFF;--rk-colors-actionButtonBorder:rgba(0, 0, 0, 0.04);--rk-colors-actionButtonBorderMobile:rgba(0, 0, 0, 0.06);--rk-colors-actionButtonSecondaryBackground:rgba(0, 0, 0, 0.06);--rk-colors-closeButton:rgba(60, 66, 66, 0.8);--rk-colors-closeButtonBackground:rgba(0, 0, 0, 0.06);--rk-colors-connectButtonBackground:#FFF;--rk-colors-connectButtonBackgroundError:#FF494A;--rk-colors-connectButtonInnerBackground:linear-gradient(0deg, rgba(0, 0, 0, 0.03), rgba(0, 0, 0, 0.06));--rk-colors-connectButtonText:#25292E;--rk-colors-connectButtonTextError:#FFF;--rk-colors-connectionIndicator:#30E000;--rk-colors-downloadBottomCardBackground:linear-gradient(126deg, rgba(255, 255, 255, 0) 9.49%, rgba(171, 171, 171, 0.04) 71.04%), #FFFFFF;--rk-colors-downloadTopCardBackground:linear-gradient(126deg, rgba(171, 171, 171, 0.2) 9.49%, rgba(255, 255, 255, 0) 71.04%), #FFFFFF;--rk-colors-error:#FF494A;--rk-colors-generalBorder:rgba(0, 0, 0, 0.06);--rk-colors-generalBorderDim:rgba(0, 0, 0, 0.03);--rk-colors-menuItemBackground:rgba(60, 66, 66, 0.1);--rk-colors-modalBackdrop:rgba(0, 0, 0, 0.3);--rk-colors-modalBackground:#FFF;--rk-colors-modalBorder:transparent;--rk-colors-modalText:#25292E;--rk-colors-modalTextDim:rgba(60, 66, 66, 0.3);--rk-colors-modalTextSecondary:rgba(60, 66, 66, 0.6);--rk-colors-profileAction:#FFF;--rk-colors-profileActionHover:rgba(255, 255, 255, 0.5);--rk-colors-profileForeground:rgba(60, 66, 66, 0.06);--rk-colors-selectedOptionBorder:rgba(60, 66, 66, 0.1);--rk-colors-standby:#FFD641;--rk-shadows-connectButton:0px 4px 12px rgba(0, 0, 0, 0.1);--rk-shadows-dialog:0px 8px 32px rgba(0, 0, 0, 0.32);--rk-shadows-profileDetailsAction:0px 2px 6px rgba(37, 41, 46, 0.04);--rk-shadows-selectedOption:0px 2px 6px rgba(0, 0, 0, 0.24);--rk-shadows-selectedWallet:0px 2px 6px rgba(0, 0, 0, 0.12);--rk-shadows-walletLogo:0px 2px 16px rgba(0, 0, 0, 0.16);}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://base.org" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="../../../../img/logo.svg" alt="Base" class="themedImage_RWGG themedImage--light_riBm"><img src="../../../../img/logo_dark.svg" alt="Base" class="themedImage_RWGG themedImage--dark_Dsi0"></div></a><a class="navbar__item navbar__link" href="../../../../index.html">Documentation</a><a class="navbar__item navbar__link" href="../../welcome/index.html">Base Camp</a><a class="navbar__item navbar__link" href="../../../../security/index.html">Security</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://www.twitter.com/BuildOnBase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://base.org/discord" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.github.com/base-org" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_xrOJ"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV docsWrapper_BqXd"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docPage_pOTq"><aside class="theme-doc-sidebar-container docSidebarContainer_aIKW"><div class="sidebarViewport_DwR9"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../../welcome/index.html">Welcome to Base Camp</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../../introduction-to-ethereum/intro-to-ethereum-vid/index.html">Introduction to Ethereum</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="../../introduction-to-solidity/introduction-to-solidity-overview/index.html">Smart Contract Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item sidebar-reading"><a class="menu__link" tabindex="0" href="../../introduction-to-solidity/introduction-to-solidity-overview/index.html">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item sidebar-video"><a class="menu__link" tabindex="0" href="../../introduction-to-solidity/anatomy-of-a-smart-contract-vid/index.html">Anatomy of a Smart Contract</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../introduction-to-solidity/introduction-to-solidity-vid/index.html">Introduction to Solidity</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../contracts-and-basic-functions/intro-to-contracts-vid/index.html">Contracts and Basic Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../deployment-to-testnet/overview-of-test-networks-vid/index.html">Deploying to a Testnet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../control-structures/standard-control-structures-vid/index.html">Control Structures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="../simple-storage-video/index.html">Storage in Solidity</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item sidebar-video"><a class="menu__link" tabindex="0" href="../simple-storage-video/index.html">Simple Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item sidebar-coding"><a class="menu__link" tabindex="0" href="../simple-storage-sbs/index.html">Storing Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item sidebar-video"><a class="menu__link" tabindex="0" href="../how-storage-works-video/index.html">How Storage Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item sidebar-reading"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="index.html">How Storage Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item sidebar-exercise"><a class="menu__link" tabindex="0" href="../storage-exercise/index.html">Storage Exercise</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../arrays/arrays-in-solidity-vid/index.html">Arrays in Solidity</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../mappings/mappings-vid/index.html">The Mapping Type</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../advanced-functions/function-visibility-vid/index.html">Advanced Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../structs/structs-vid/index.html">Structs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../inheritance/inheritance-vid/index.html">Inheritance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../imports/imports-vid/index.html">Imports</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../error-triage/error-triage-vid/index.html">Errors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="../../new-keyword/creating-a-new-contract-vid/index.html">The `new` Keyword</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../../intro-to-tokens/intro-to-tokens-vid/index.html">Token Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../../hardhat-setup-overview/hardhat-overview-vid/index.html">Development with Hardhat</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_Ftvb"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_c4WT"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_fv3b"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="../../../../index.html"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Smart Contract Development</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Storage in Solidity</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How Storage Works</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How Storage Works</h1></header><p>In this article, we will delve into the workings of Ethereum storage, explore the nuances of variable declaration ordering, and provide examples of efficient and inefficient storage practices to create optimized smart contracts.</p><hr><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="objectives">Objectives:<a href="#objectives" class="hash-link" aria-label="Direct link to Objectives:" title="Direct link to Objectives:">​</a></h2><p>By the end of this lesson you should be able to:</p><ul><li>Diagram how a contracts data is stored on the blockchain (Contract -&gt; Blockchain)</li><li>Order variable declarations to use storage efficiently</li><li>Diagram how variables in a contract are stored (Variable -&gt; Contract)</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Creating smart contracts that can operate efficiently requires a thorough understanding of how storage works in Ethereum. When designing a contract, you need to consider the storage requirements of the contract, including the types of storage needed, the gas costs associated with storage operations, and how to manage storage effectively. Poor storage management practices can lead to bloated contracts that consume excessive gas, making them more expensive to execute. By following best practices for storage management, you&#x27;ll be equipped to create contracts that are lean, efficient, and cost-effective.</p><hr><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="smart-contract-data-storage">Smart Contract Data Storage<a href="#smart-contract-data-storage" class="hash-link" aria-label="Direct link to Smart Contract Data Storage" title="Direct link to Smart Contract Data Storage">​</a></h2><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="key-value-store">Key-Value Store<a href="#key-value-store" class="hash-link" aria-label="Direct link to Key-Value Store" title="Direct link to Key-Value Store">​</a></h3><p>Smart contracts on Ethereum store and manage data utilizing a key-value store model, where each piece of data is identified by a unique key and accompanied by its corresponding value.</p><p>In this diagram, the keys (user addresses) are unique identifiers used to index the corresponding values (balances):</p><p><img loading="lazy" alt="Key Value Store" src="../../../../assets/images/key-value-store-ceb69da53197d82d32aff16593de8503.png" width="400" height="400" class="img__Ss2"></p><p>This model can be compared to a dictionary or a map where the key serves as the index and the value represents the data associated with that index. However, the key-value store has distinct characteristics that set it apart from these traditional data structures, which make it a more optimal choice for smart contracts on Ethereum.</p><ul><li><p><strong>Simplicity:</strong> It is simple and straightforward, which allows for easier implementation and maintenance within a contract.</p></li><li><p><strong>Scalability:</strong> It is highly scalable, making it well-suited for managing vast amounts of data typically associated with dapps and smart contracts. This scalability helps maintain performance levels even as data storage requirements grow.</p></li><li><p><strong>Fixed-size chunks:</strong> Storing data in fixed-size 32-byte chunks optimizes storage space and ensures that data location calculations are more efficient. This feature is particularly beneficial in the context of Ethereum, where storage costs are a significant concern.</p></li><li><p><strong>Efficient storage and retrieval:</strong> It is optimized for storing and retrieving large volumes of data efficiently, which is essential for quick access to stored information.</p></li><li><p><strong>Security and immutability:</strong> Unlike other storage models that may allow direct data manipulation, key-value stores within Ethereum&#x27;s environment ensure data integrity and security through transaction-based modifications. This feature aligns with the decentralized and trustless nature of blockchain technology.</p></li><li><p><strong>Gas-efficiency:</strong> In Ethereum, every operation within a smart contract execution consumes gas. The key-value store model is designed to be gas-efficient, minimizing the gas consumption for storage and retrieval operations, thus reducing the overall cost of contract execution.</p></li><li><p><strong>Compatibility with decentralized environments:</strong> It is particularly suitable for decentralized environments, where data consistency, integrity, and security are crucial. The model&#x27;s design inherently addresses the challenges posed by multi-threaded or concurrent environments where multiple processes or functions may attempt to access or modify the same data simultaneously.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="types-of-storage">Types of Storage<a href="#types-of-storage" class="hash-link" aria-label="Direct link to Types of Storage" title="Direct link to Types of Storage">​</a></h3><p>There are three primary types of storage in Ethereum smart contracts: storage, memory, and stack. Each type has its specific use case and characteristics, which make them suitable for different aspects of smart contract execution.</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage">​</a></h4><p>Storage is the most persistent and expensive form of data storage. Data stored in the contract&#x27;s storage persists across transaction executions and is accessible to any function within the smart contract. This storage is also visible on the blockchain and can be read by external sources, making it suitable for storing important and long-lasting information related to the contract&#x27;s state.</p><p>Key attributes of storage:</p><ul><li><p><strong>Persistent:</strong> Data remains in storage even after the contract execution finishes, allowing for state continuity across multiple transactions.</p></li><li><p><strong>Expensive:</strong> Storing and modifying data in storage consumes more gas compared to other data locations, making it costly in terms of transaction fees.</p></li><li><p><strong>Visible on the blockchain:</strong> Storage data is publicly available and can be read by external parties.</p></li></ul><p>Consider the following contract:</p><div class="language-solidity codeBlockContainer_ZGJx theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-solidity codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">contract</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">StorageDemo</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Declare a state variable to store data in storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> storedData</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Function to update the storedData variable in storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">updateData</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> newData</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        storedData </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> newData</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg class="copyButtonIcon_yxgH" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_QJLJ" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The contract includes a state variable called <code>storedData</code>, which is stored in the contract&#x27;s storage. The <code>public</code> visibility modifier allows anyone to access this variable. The contract also includes a public function called <code>updateData</code>, which can be called by anyone to modify the value of <code>storedData</code> in storage.</p><p>Any changes made to <code>storedData</code> in storage will persist across multiple transactions and will be visible to anyone who reads the blockchain. Please note that storage is more expensive than other data locations, so it is important to use it judiciously to minimize gas costs.</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="memory">Memory<a href="#memory" class="hash-link" aria-label="Direct link to Memory" title="Direct link to Memory">​</a></h4><p>Memory is a temporary and more affordable data location. It&#x27;s used to save data during the execution of a single transaction. Once the transaction is complete, the memory is wiped clean and any data within it is lost. Memory is suitable for storing intermediate variables and temporary data that does not need to persist across multiple transactions.</p><p>Key attributes of memory:</p><ul><li><p><strong>Temporary:</strong> Data in memory is only available during a single transaction execution and is lost afterward.</p></li><li><p><strong>Less expensive:</strong> Saving and modifying data in memory consumes less gas compared to storage, making it more cost-effective for temporary data.</p></li><li><p><strong>Not visible on the blockchain:</strong> Memory data is not accessible to external parties and remains confined to the transaction execution.</p></li></ul><p>Consider the following contract:</p><div class="language-solidity codeBlockContainer_ZGJx theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-solidity codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">contract</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MemoryDemo</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Declare a state variable to store data in storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> storedData</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Function to update the storedData variable in memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">updateData</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> newData</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Declare a memory variable to store the new data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> tempData </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> newData</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Assign the value of the memory variable to the storage variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        storedData </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> tempData</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg class="copyButtonIcon_yxgH" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_QJLJ" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the contract, we declare a memory variable called <code>tempData</code> and assign the input parameter <code>newData</code> to it to update its value. The <code>tempData</code> variable is then assigned to the <code>storedData</code> variable to update its value in storage.</p><p>Unlike storage, data stored in memory is not persisted across transactions and is only accessible during the execution of the function. However, accessing and modifying data in memory is less expensive than doing so in storage, making it a more efficient option when dealing with temporary data. Additionally, any data stored in memory is not visible on the blockchain and cannot be read by external parties.</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="stack">Stack<a href="#stack" class="hash-link" aria-label="Direct link to Stack" title="Direct link to Stack">​</a></h4><p>The stack is another form of temporary data storage, specifically used for holding function arguments, local variables, and intermediate values during function execution. The stack follows a Last-In-First-Out (LIFO) structure, meaning that the most recently added item is the first to be removed. This storage type is highly efficient but has limited space, making it suitable for small-scale data manipulation during function execution.</p><p>The stack is an internal data structure used by the EVM (Ethereum Virtual Machine) for computation during the execution of transactions. When a transaction is executed by the EVM, the bytecode of the smart contract is loaded into memory, and the EVM uses the stack to keep track of intermediate results and execute operations.</p><p>In Solidity, developers do not interact with the stack directly, but can optimize their code to make the best use of it and minimize the amount of gas used during transaction execution. This can include using more efficient algorithms or data structures, or avoiding unnecessary operations that can increase the depth of the stack.</p><p>Key attributes of the stack:</p><ul><li><p><strong>Temporary:</strong> Like memory, stack data is only available during a single transaction execution and is lost afterward.</p></li><li><p><strong>Highly efficient:</strong> Stack operations consume minimal gas, making it the most cost-effective storage option for small-scale data manipulation.</p></li><li><p><strong>LIFO structure:</strong> The stack follows the Last-In-First-Out order, which allows for efficient management of function arguments, local variables, and intermediate values.</p></li><li><p><strong>Limited space:</strong> The stack has a maximum depth of 1024, restricting the number of elements it can hold at a given time.</p></li><li><p><strong>Limited visibility:</strong> Only the top 16 elements in the stack are accessible, limiting how many variables and other elements can be in scope at one time.</p></li></ul><p>Let&#x27;s compare two versions of a function and analyze their gas efficiency with regard to stack usage and gas consumption:</p><div class="language-solidity codeBlockContainer_ZGJx theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-solidity codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">contract</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GasEfficiencyDemo</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> result</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Less efficient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">sumLessEfficient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> a</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> b</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> temp </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> a </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        result </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> temp</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// More efficient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">sumMoreEfficient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> a</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> b</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        result </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> a </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg class="copyButtonIcon_yxgH" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_QJLJ" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the <code>sumLessEfficient</code> function, the sum of the two input arguments <code>a</code> and <code>b</code> is first assigned to the temporary variable <code>temp</code> before being assigned to the state variable <code>result</code>. This additional step introduces an extra variable on the stack, which requires more gas for stack operations and consumes more gas overall.</p><p>In contrast, the <code>sumMoreEfficient</code> function directly assigns the sum of the input arguments <code>a</code> and <code>b</code> to the state variable result. This eliminates the need for the temporary variable and reduces the stack usage, leading to lower gas consumption for stack operations and a more gas-efficient execution.</p><p>Although the difference in gas consumption between these two functions may not be significant for such a simple example, the principle of minimizing stack usage and optimizing code to reduce gas consumption is essential for developing efficient smart contracts. By avoiding unnecessary variables and operations, you can improve the gas efficiency of your functions and reduce the cost of executing them on the EVM.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="variable-storage">Variable Storage<a href="#variable-storage" class="hash-link" aria-label="Direct link to Variable Storage" title="Direct link to Variable Storage">​</a></h2><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="variable-packing">Variable Packing<a href="#variable-packing" class="hash-link" aria-label="Direct link to Variable Packing" title="Direct link to Variable Packing">​</a></h3><p>As we&#x27;ve learned, minimizing the storage footprint of a contract can substantially reduce gas costs. To make storage more efficient, Ethereum employs a concept called variable packing.</p><p>Variable packing is the process of placing multiple smaller variables into a single storage slot to optimize storage usage. A storage slot is a fixed-size container that can hold up to 32 bytes of data. Ethereum&#x27;s Solidity compiler automatically packs smaller variables together if they can fit into a single storage slot.</p><p><img loading="lazy" alt="Variable Packing" src="../../../../assets/images/variable-packing-5bb5693e1b5fee34031076abe87291d4.png" width="500" height="411" class="img__Ss2"></p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="ordering-variable-declarations">Ordering Variable Declarations<a href="#ordering-variable-declarations" class="hash-link" aria-label="Direct link to Ordering Variable Declarations" title="Direct link to Ordering Variable Declarations">​</a></h3><p>When declaring variables in a contract, their order can impact a contract&#x27;s gas usage. You can optimize storage by declaring variables of similar sizes together, such that they can be packed into the same storage slot.</p><p>Let&#x27;s illustrate how this works:</p><div class="language-solidity codeBlockContainer_ZGJx theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-solidity codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">contract</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">StoragePackingExample</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint8</span><span class="token plain"> a</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// 1 byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint8</span><span class="token plain"> b</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// 1 byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> c</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// 32 bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg class="copyButtonIcon_yxgH" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_QJLJ" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the compiler will automatically pack <code>a</code> and <code>b</code> into the same storage slot, as they are both 1-byte variables and can fit into a single 32-byte storage slot. However, <code>c</code> requires a separate storage slot due to its size (32 bytes).</p><p><img loading="lazy" alt="Variable Order Optimized" src="../../../../assets/images/variable-order-optimized-a07252a8af321a2c6cfcaff878547850.png" width="500" height="365" class="img__Ss2"></p><p>If these variables were not in the correct order, the contract would not take advantage of variable packing. The variables would take up more storage and would potentially consume more gas to execute the contract.</p><p>Let&#x27;s consider an inefficient example:</p><div class="language-solidity codeBlockContainer_ZGJx theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-solidity codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">contract</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">StoragePackingBadExample</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint8</span><span class="token plain"> a</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// 1 byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint256</span><span class="token plain"> b</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// 32 bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token builtin" style="color:#D8DEE9">uint8</span><span class="token plain"> c</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// 1 byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg class="copyButtonIcon_yxgH" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_QJLJ" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this contract, the variables are not declared in the optimal order, and the compiler would store these variables in the following way:</p><p><img loading="lazy" alt="Variable Order Inefficient" src="../../../../assets/images/variable-order-inefficient-87b96b4607e001852fc3e455582a48fb.png" width="500" height="419" class="img__Ss2"></p><p>To make the most of variable packing, it&#x27;s important to group variables of the same size together and avoid mixing variable sizes. ​By doing this, the compiler can store them more efficiently, reducing the overall storage usage of the contract. This optimization will not only reduce the gas costs associated with storage, but it will also improve the contract&#x27;s execution speed.</p><hr><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Creating efficient and optimized smart contracts on Ethereum requires a thorough understanding of how storage works. Smart contracts use a key-value store model to manage and store data, which is simple, scalable, gas-efficient, and suitable for decentralized environments. There are three types of storage in Ethereum smart contracts: storage, memory, and stack, each with specific characteristics. Developers can optimize storage usage by using variable packing and ordering variable declarations based on their size. By following best practices for storage management, developers can create contracts that are lean, efficient, cost-effective, and improve their execution speed.</p><hr><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="see-also">See Also<a href="#see-also" class="hash-link" aria-label="Direct link to See Also" title="Direct link to See Also">​</a></h2><ul><li><a href="https://programtheblockchain.com/posts/2018/03/09/understanding-ethereum-smart-contract-storage/" target="_blank" rel="noopener noreferrer">Understanding Ethereum Smart Contract Storage</a></li><li><a href="https://docs.alchemy.com/docs/smart-contract-storage-layout" target="_blank" rel="noopener noreferrer">What is Smart Contract Storage Layout</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="../how-storage-works-video/index.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How Storage Works</div></a><a class="pagination-nav__link pagination-nav__link--next" href="../storage-exercise/index.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Storage Exercise</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives:</a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#smart-contract-data-storage" class="table-of-contents__link toc-highlight">Smart Contract Data Storage</a><ul><li><a href="#key-value-store" class="table-of-contents__link toc-highlight">Key-Value Store</a></li><li><a href="#types-of-storage" class="table-of-contents__link toc-highlight">Types of Storage</a></li></ul></li><li><a href="#variable-storage" class="table-of-contents__link toc-highlight">Variable Storage</a><ul><li><a href="#variable-packing" class="table-of-contents__link toc-highlight">Variable Packing</a></li><li><a href="#ordering-variable-declarations" class="table-of-contents__link toc-highlight">Ordering Variable Declarations</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See Also</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://stack.optimism.io" rel="noopener noreferrer" class="footerLogoLink_zxYv"><img src="../../../../img/op_stack.svg" alt="Built on the OP Stack" class="themedImage_RWGG themedImage--light_riBm footer__logo" width="160" height="51"><img src="../../../../img/op_stack_dark.svg" alt="Built on the OP Stack" class="themedImage_RWGG themedImage--dark_Dsi0 footer__logo" width="160" height="51"></a></div><div class="footer__copyright">© 2023 Coinbase</div></div></div></footer></div></div>
<script src="../../../../assets/js/runtime~main.3b600ada.js"></script>
<script src="../../../../assets/js/main.5ec255ba.js"></script>
</body>
</html>